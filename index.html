<!DOCTYPE html><html lang="zh-CN"><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>å¿ƒæ„ç›²ç›’</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
  
  <style>
    /* ---------------------------------- */
    /* V25 å…³é”®å¸§åŠ¨ç”» (100% ç¨³å®š) */
    /* ---------------------------------- */
    
    /* V10 æå…‰æµåŠ¨ (ä¿æŒç¨³å®š) */
    @keyframes gradient-flow {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    /* V18 æ¨±èŠ±é£˜è½ (ä¿æŒç¨³å®š) */
    @keyframes sakura-full-animation {
      0% {
        transform: translateY(-10vh) translateX(0px) rotate(0deg);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      25% {
        transform: translateY(25vh) translateX(var(--drift-x)) rotate(90deg);
      }
      50% {
        transform: translateY(50vh) translateX(0px) rotate(180deg);
      }
      75% {
        transform: translateY(75vh) translateX(var(--drift-x-neg)) rotate(270deg);
      }
      90% {
        opacity: 1;
      }
      100% {
        transform: translateY(110vh) translateX(0px) rotate(360deg);
        opacity: 0;
      }
    }

    /* ---------------------------------- */
    /* V25 æ ¸å¿ƒ CSS (V10 æ¶æ„) */
    /* ---------------------------------- */
    
    /* V10 åˆå§‹å¼¹çª— (ä¿æŒç¨³å®š) */
    .modal-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);  
      display: flex;
      justify-content: center;
      align-items: center;
      transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
      opacity: 1;
      visibility: visible;
      z-index: 1000; 
    }
    .modal-backdrop[aria-hidden="true"] {
      opacity: 0;
      visibility: hidden;  
      pointer-events: none;  
    }
    .modal {
      background-color: #ffffff;
      border-radius: 12px;  
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
      width: 90%;
      max-width: 400px;
      overflow: hidden;
      opacity: 1;
      transform: scale(1);
      transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55), opacity 0.5s ease-in;  
      z-index: 1001; 
    }
    .modal-backdrop[aria-hidden="true"] .modal {
      transform: scale(0.8);
      opacity: 0;
    }
    .modal .titlebar { display: flex; align-items: center; padding: 15px 20px; border-bottom: 1px solid #eee; background-color: #fcfcfc; }
    .modal .titlebar .icon { font-size: 24px; margin-right: 10px; }
    .modal .titlebar .title { font-size: 20px; font-weight: 600; color: #333; }
    .modal .content { padding: 30px 20px; font-size: 18px; color: #333; text-align: center; line-height: 1.6; }
    .modal .actions { display: flex; justify-content: center; padding: 20px; border-top: 1px solid #eee; background-color: #fcfcfc; }
    .modal .btn {  
      padding: 12px 35px;  
      border: none;  
      border-radius: 30px;
      font-size: 17px;  
      cursor: pointer;  
      transition: all 0.3s ease;
      color: #fff;
      font-weight: 600;
      background-image: linear-gradient(135deg, #8a2be2 0%, #ff69b4 100%);
      box-shadow: 0 5px 15px rgba(138, 43, 226, 0.4);
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }
    .modal .btn.primary:hover {
      background-image: linear-gradient(135deg, #ff69b4 0%, #8a2be2 100%);
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 20px rgba(255, 105, 180, 0.5);
    }
    
    /* --- V25 åä¸½èƒŒæ™¯ (100% å®‰å…¨) --- */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Noto Sans SC', sans-serif;
      min-height: 100vh;
      overflow: hidden;  
      background-color: #0d0d2b; 
    }
    
    .bg-layer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none; 
      transition: opacity 2s ease-in-out; 
    }

    /* V21 æ˜äº®æå…‰ (ä¿æŒç¨³å®š) */
    #bg-scene-1 {
      background: linear-gradient(270deg, #fce4ec, #e1bee7, #bbdefb, #e8f5e9, #fce4ec);
      background-size: 400% 400%;
      animation: gradient-flow 30s ease-in-out infinite;
      z-index: 1; 
      opacity: 1;
      overflow: hidden; 
    }
    #bg-scene-1.hidden {
      opacity: 0;
    }
    
    /* V19 å…¨å±€ç²’å­å±‚ (ä¿æŒç¨³å®š) */
    #particle-field {
      position: fixed; 
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: 5; 
      pointer-events: none;
    }

    /* V20 æ¨±èŠ± ğŸŒ¸ ç²’å­ (ä¿æŒç¨³å®š) */
    .particle {
      position: absolute; 
      will-change: transform, opacity;
      animation: 
        sakura-full-animation var(--fall-dur) linear var(--delay) infinite;
      
      line-height: 1;
      user-select: none; 
    }
    
    /* åœºæ™¯ 2: æ˜äº®æå…‰ (V12 ç¨³å®šæ–¹æ¡ˆ) */
    #bg-scene-2 {
      background: linear-gradient(270deg, #fce4ec, #e1bee7, #bbdefb, #e8f5e9, #fce4ec);
      background-size: 400% 400%;
      animation: gradient-flow 30s ease-in-out infinite;
      z-index: 2; 
      opacity: 0; 
      overflow: hidden;
    }
    #bg-scene-2.visible {
      opacity: 1; 
    }

    /* V23 ç²¾ç»†åŒ– SVG (ä¿æŒç¨³å®š) */
    #peppa-pig-svg {
      position: absolute;
      bottom: 15px; 
      left: 50%;
      transform: translateX(-50%);
      width: 180px; 
      height: auto; 
      z-index: 3; 
      pointer-events: none;
      filter: drop-shadow(0 5px 10px rgba(0,0,0,0.2)); 
    }
    #peppa-pig-svg .skin { fill: #FFDAB9; stroke: #E66A9B; stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round; }
    #peppa-pig-svg .dress { fill: #FF69B4; stroke: #E66A9B; stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round; }
    #peppa-pig-svg .eye { fill: white; stroke: #333; stroke-width: 1; }
    #peppa-pig-svg .pupil { fill: #333; stroke: none; }
    #peppa-pig-svg .cheek { fill: #FFB6C1; stroke: #E66A9B; stroke-width: 1.5; }
    #peppa-pig-svg .mouth { fill: none; stroke: #E66A9B; stroke-width: 2.5; stroke-linecap: round; }
    #peppa-pig-svg .nose-hole { fill: #E66A9B; stroke: none; }
    #peppa-pig-svg .shoes { fill: #333333; stroke: #333333; stroke-width: 1; }
    #peppa-pig-svg .tail { fill: none; stroke: #E66A9B; stroke-width: 2.5; stroke-linecap: round; }


    /* ---------------------------------- */
    /* åœºæ™¯äºŒ (å¿ƒæ„ä¹‹å¢™) (V24 èšç„¦ä¿®å¤) */
    /* ---------------------------------- */
    #popup-layer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;  
      z-index: 900; 
      overflow: hidden;  
      /* V23 é®ç½©è¿‡æ¸¡ (ä¿æŒç¨³å®š) */
      transition: background-color 0.4s ease;
    }
    .popup-message {
      position: absolute;
      border-radius: 15px;  
      background-color: rgba(255, 255, 255, 0.7);  
      -webkit-backdrop-filter: blur(10px) saturate(120%);
      backdrop-filter: blur(10px) saturate(120%);
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
      padding: 15px 25px;
      width: auto;
      max-width: 280px;  
      text-align: center;
      cursor: pointer;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0) rotate(0deg);
      opacity: 0;
      
      /* V23 åˆå§‹çˆ†å‘ (ä¿æŒç¨³å®š) */
      transition: all 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55);
      z-index: 901; 
    }
    .popup-message.burst-in {
      top: var(--final-top);
      left: var(--final-left);
      transform: translate(-50%, -50%) scale(1) rotate(var(--final-rotate));
      opacity: 0.8;  
    }
    
    /* V20 :hover (ä¿æŒç¨³å®š) */
    .popup-message:hover {
      opacity: 1;
      z-index: 99998 !important; 
      transform: translate(-50%, -50%) scale(1.1) rotate(var(--final-rotate)) !important;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }
    
    /* V23 é®ç½© (ä¿æŒç¨³å®š) */
    #popup-layer.is-focused {
      background-color: rgba(0, 0, 0, 0.3);
    }
    
    /* V24 ä¿®å¤ (Bug 1): 100% ä¿®å¤â€œä¸ä¸€è‡´â€ å’Œ â€œé‚£ä¹ˆæ·¡â€ */
    #popup-layer.is-focused .popup-message:not(.focused) {
      transition: opacity 0.4s ease, transform 0.4s ease;
      
      /* V24 ä¿®å¤: 0.2 (ä¿®å¤ "é‚£ä¹ˆæ·¡") */
      opacity: 0.2 !important; 
      /* V24 ä¿®å¤: !important (ä¿®å¤ "ä¸ä¸€è‡´" Bug) */
      
      pointer-events: none;  
    }
    
    /* V23 èšç„¦ (ä¿æŒç¨³å®š) */
    .popup-message.focused {
      top: 50% !important;  
      left: 50% !important;
      transform: translate(-50%, -50%) scale(1.2) rotate(0deg) !important;  
      opacity: 1;
      z-index: 99999 !important; 
    }
    
    .popup-message .icon {
      font-size: 32px;
      margin-bottom: 10px;
      display: block;
    }
    .popup-message .content {  
      font-size: 24px;  
      line-height: 1.6;  
      font-family: 'Ma Shan Zheng', cursive;  
      color: #333;
    }
  </style>

  </head><body>
  
  <div class="bg-layer" id="bg-scene-1"></div>
  <div class="bg-layer" id="bg-scene-2">
    
    <svg id="peppa-pig-svg" viewBox="-10 0 120 105" xmlns="http://www.w.org/2000/svg">
      <g id="peppa-v23">
        <path class="tail" d="M 68,85 Q 75,80 75,85 Q 75,90 68,85" />
        <path class="skin" d="M 45,90 L 45,100" />
        <path class="skin" d="M 55,90 L 55,100" />
        <ellipse class="shoes" cx="45" cy="100" rx="3" ry="2" />
        <ellipse class="shoes" cx="55" cy="100" rx="3" ry="2" />
        <path class="dress" d="M 35,60 C 30,80 30,90 30,90 L 70,90 C 70,90 70,80 65,60 Z" />
        <path class="skin" d="M 33,65 L 20,70" />
        <path class="skin" d="M 67,65 L 80,70" />
        <path class="skin" d="M 50,15 C 20,15 5,40 5,60 C 5,80 30,95 50,85 C 75,80 95,65 95,45 C 95,25 75,10 50,15 Z" />
        <path class="skin" d="M 5,60 C -5,60 -5,50 5,50 C 15,50 15,60 5,60 Z" />
        <path class="skin" d="M 40,15 C 35,5 30,15 30,15" />
        <path class="skin" d="M 50,12 C 55,2 60,12 60,12" />
        <circle cx="42" cy="40" r="5" class="eye" />
        <circle cx="43" cy="40" r="2" class="pupil" />
        <circle cx="58" cy="40" r="5" class="eye" />
        <circle cx="59" cy="40" r="2" class="pupil" />
        <circle cx="8" cy="55" r="2" class="nose-hole" />
        <circle cx="15" cy="55" r="2" class="nose-hole" />
        <circle cx="75" cy="55" r="10" class="cheek" />
        <path class="mouth" d="M 40,70 Q 50,75 60,70" />
      </g>
    </svg>
    
  </div>
  
  <div id="particle-field"></div>

  <div class="modal-backdrop" id="start-backdrop" aria-hidden="false">
    <div class="modal" id="initial-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <div class="titlebar">
        <span class="icon">âœ¨</span>
        <span class="title" id="modal-title">å¿ƒæ„ç›²ç›’</span>
      </div>
      <div class="content">Hiï¼Œå°ç³å®å®ï¼š<br>ä¸ºä½ æ‰“å¼€è¿™ç‰‡æ¸©æŸ”çš„æ˜Ÿæµ·...</div>
      <div class="actions">
        <button class="btn primary" id="confirm-btn" autofocus>å¼€å¯</button>
      </div>
    </div>
  </div>

  <div id="popup-layer" aria-live="polite">
    </div>

  <audio id="bgMusic" loop preload="auto">
    <source src="https://sf5-hl-cdn-tos.douyinstatic.com/obj/ies-music/7499771397531503370.mp3" type="audio/mpeg">
  </audio>
  <audio id="clickSound" preload="auto">
    <source src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_349d3e8e19.mp3?filename=button-click-sound-effect-153308.mp3" type="audio/mpeg">
  </audio>
  <audio id="burstSound" preload="auto">
    <source src="https://cdn.pixabay.com/download/audio/2022/05/27/audio_651917f6fc.mp3?filename=magic-chime-01-112704.mp3" type="audio/mpeg">
  </audio>

  <script>
    // --- 1. è·å–æ‰€æœ‰å…ƒç´  (100% å®‰å…¨è·å–) ---
    const bgMusic = document.getElementById('bgMusic');
    const clickSound = document.getElementById('clickSound');
    const burstSound = document.getElementById('burstSound');
    const confirmBtn = document.getElementById('confirm-btn');
    const startBackdrop = document.getElementById('start-backdrop');
    const initialModal = document.getElementById('initial-modal');  
    const popupLayer = document.getElementById('popup-layer');

    const bgScene1 = document.getElementById('bg-scene-1');
    const bgScene2 = document.getElementById('bg-scene-2');
    const particleField = document.getElementById('particle-field');
    
    // V20 Z-Index ä»²è£å™¨ (ä¿æŒ)
    let currentTopZ = 901;
    
    /* V24 å…¨å±€å¸¸é‡ (V23 ä¿æŒç¨³å®š) */
    const MAX_CONCURRENT_RECYCLES = 3;  
    const RECYCLE_WORKER_SLEEP_MIN = 1000; 
    const RECYCLE_WORKER_SLEEP_MAX = 2000; 
    const RECYCLE_ANIM_DURATION = 2000;    
    const FOCUS_ANIM_DURATION = 400;

    // --- 2. æ¶ˆæ¯æ•°æ® (V15 è¯­æ³•å·²ä¿®å¤, ä¿æŒç¨³å®š) ---
    const messages = [
      { icon: 'ğŸ¥°', text: 'â€œä»Šå¤©... æˆ‘åˆæƒ³äº†ä½  100 æ¬¡ã€‚â€' },
      { icon: 'ğŸŒŸ', text: 'â€œä½ çš„ç¬‘å®¹ï¼Œæ˜¯æˆ‘ä¸€æ•´å¤©çš„èƒ½é‡æ¥æºã€‚â€' },
      { icon: 'ğŸ’–', text: 'â€œçŒœçŒœæˆ‘çš„å¿ƒåœ¨å“ªï¼Ÿ... åœ¨ä½ é‚£è¾¹ã€‚â€' },
      { icon: 'ğŸŒ¸', text: 'â€œé‡è§ä½ ä¹‹åï¼Œæˆ‘æ‰å‘ç°æ˜Ÿæ˜Ÿä¼šè·‘åˆ°æˆ‘çœ¼ç›é‡Œã€‚â€' },
      { icon: 'ğŸ€', text: 'â€œå¸Œæœ›ä½ ä»Šå¤©ä¹Ÿæ˜¯ä¸ªå¼€å¿ƒçš„å°å°æœ‹å‹ã€‚â€' },
      { icon: 'âœ¨', text: 'â€œåˆ«å¤ªç´¯å•¦ï¼Œæˆ‘ä¼šå¿ƒç–¼çš„ã€‚â€' },
      { icon: 'ğŸŒˆ', text: 'â€œä½ çŒœï¼Œâ€˜å¯çˆ±â€™çš„è¿‘ä¹‰è¯æ˜¯ä»€ä¹ˆï¼Ÿ... æ˜¯ä½ ã€‚â€' },
      { icon: 'ğŸ’«', text: 'â€œä¸–ç•Œå¾ˆå¤§ï¼Œä½†æˆ‘åªæƒ³å’Œä½ å¾…åœ¨ä¸€èµ·ã€‚â€' },
      { icon: 'ğŸ', text: 'â€œä½ æ˜¯æˆ‘æ‰“å¼€è¿‡çš„ï¼Œæœ€æ£’çš„ç¤¼ç‰©ã€‚â€' },
      { icon: 'â¤ï¸', text: 'â€œä¸åªæ˜¯ä»Šå¤©... è€Œæ˜¯æ¯ä¸€å¤©ï¼Œæˆ‘éƒ½... (ä½ æ‡‚çš„)â€' },
      { icon: 'ğŸŒ™', text: 'â€œæ™šå®‰ï¼Œæ„¿ä½ æ¢¦é‡Œæœ‰æˆ‘çš„æ¸©æŸ”ã€‚â€' },
      { icon: 'â˜€ï¸', text: 'â€œæ—©å®‰ï¼Œæ–°çš„ä¸€å¤©ä¹Ÿæƒ³ä½ ã€‚â€' },
      { icon: 'â˜•', text: 'â€œè®°å¾—ä¼‘æ¯ä¸€ä¸‹ï¼Œæˆ‘é™ªä½ ã€‚â€' },
      { icon: 'ğŸ¬', text: 'â€œä½ æ¯”ç³–æœè¿˜ç”œï¼Œç”œåˆ°æˆ‘å¿ƒé‡Œäº†ã€‚â€' },
      { icon: 'ğŸµ', text: 'â€œå¬åˆ°è¿™é¦–æ­Œï¼Œæˆ‘åˆæƒ³èµ·äº†ä½ ã€‚â€' },
      { icon: 'ğŸ€', text: 'â€œä½ å°±æ˜¯æˆ‘æœ€çè´µçš„é‚£ä¸ªâ€˜å°ç¤¼ç›’â€™ã€‚â€' },
      { icon: 'ğŸ’­', text: 'â€œæ‚„æ‚„å‘Šè¯‰ä½ ï¼Œæˆ‘åˆšåœ¨æƒ³ä½ å‘¢ã€‚â€' },
      { icon: 'ğŸ¥³', text: 'â€œæœ‰ä½ åœ¨ï¼Œæ¯å¤©éƒ½æ˜¯å€¼å¾—åº†ç¥çš„å¥½æ—¥å­ã€‚â€' },
      { icon: 'ğŸ¤—', text: 'â€œæƒ³ç»™ä½ ä¸€ä¸ªå¤§å¤§çš„æ‹¥æŠ±ï¼Œç°åœ¨å°±æƒ³ã€‚â€' },
      { icon: 'ğŸ’Œ', text: 'â€œè¿™å°å¿ƒæ„ï¼Œåªä¸ºä½ ä¸€äººè€Œå†™ã€‚â€' }
    ];

    // --- 3. éŸ³é¢‘æ’­æ”¾ (V10 å®‰å…¨æ–¹æ¡ˆ) ---
    function playMusic() {
      if (bgMusic && bgMusic.paused) {  
        bgMusic.volume = 0.4;  
        bgMusic.play().catch(e => console.warn("èƒŒæ™¯éŸ³ä¹æ’­æ”¾å¤±è´¥:", e));
      }
    }

    function playSound(audioElement, volume = 0.6) {
      if (audioElement) {
        const sound = audioElement.cloneNode();
        sound.volume = volume;
        sound.play().catch(e => console.warn("éŸ³æ•ˆæ’­æ”¾å¤±è´¥:", e));
      }
    }

    // --- 4. æ ¸å¿ƒæµç¨‹ï¼šç‚¹å‡»æŒ‰é’® (V23 å¯åŠ¨ 4.4s çˆ†å‘) ---
    if (confirmBtn && startBackdrop && popupLayer && bgScene1 && bgScene2) {
      
      confirmBtn.addEventListener('click', () => {
        
        playSound(clickSound);  
        startBackdrop.setAttribute('aria-hidden', 'true');  
        
        setTimeout(() => {
          startBackdrop.style.display = 'none';  
          popupLayer.style.display = 'block';  
          playMusic(); 

          // V12 "Cross-Fade" (ä¿æŒç¨³å®š)
          bgScene1.classList.add('hidden');
          bgScene2.classList.add('visible');

          // V23 å¯åŠ¨ 4.4s çˆ†å‘ (ä¿æŒç¨³å®š)
          showMessagesBurst();
          
          // V23 å¯åŠ¨è°ƒåº¦å™¨ (ä¿æŒç¨³å®š)
          setTimeout(launchRecycleWorkers, 5000); // 4.4s + 0.6s buffer

        }, 500); 
        
      }, { once: true });
      
    } else {
      // V10 æœ€ç»ˆé˜²çº¿
      alert("ç½‘é¡µåŠ è½½å¤±è´¥äº†ï¼(å…³é”®å…ƒç´ ä¸¢å¤±) \n\nè¯·åˆ·æ–°é¡µé¢é‡è¯•ã€‚");
    }

    // --- 5. åä¸½çš„â€œçˆ†å‘â€æ•ˆæœ (V23 4.4s çˆ†å‘) ---
    const activeCards = []; 
    function showMessagesBurst() {
      if (!popupLayer) return;
      
      popupLayer.addEventListener('click', (e) => {
        if (e.target === popupLayer) {
          removeFocus();
        }
      });

      messages.forEach((msg, index) => {
        
        const popup = document.createElement('div');
        popup.className = 'popup-message';
        
        popup.innerHTML = `
          <span class="icon">${msg.icon}</span>
          <div class="content">${msg.text}</div>
        `;
        
        // V24 ä¿®å¤ (Bug 2): åˆå§‹çˆ†å‘èŒƒå›´ 10%-90% (ä¿æŒç¨³å®š)
        const randomTop = Math.random() * 80 + 10; 
        const randomLeft = Math.random() * 80 + 10;
        const randomRot = Math.random() * 40 - 20;
        
        popup.style.setProperty('--final-top', `${randomTop}%`);
        popup.style.setProperty('--final-left', `${randomLeft}%`);
        popup.style.setProperty('--final-rotate', `${randomRot}deg`);
        
        popup.addEventListener('click', (e) => {
          e.stopPropagation();  
          toggleFocus(popup);
        });
        
        /* V23 4.4s çˆ†å‘ (ä¿æŒç¨³å®š) */
        const burstClump = (Math.floor(Math.random() * 5)) * 1000; 
        const microDelay = Math.random() * 400; 
        const totalDelay = burstClump + microDelay; 

        setTimeout(() => {
          popupLayer.appendChild(popup);
          playSound(burstSound, 0.3);
          void popup.offsetWidth;  
          popup.classList.add('burst-in');
          popup.classList.add('floating'); 
          activeCards.push(popup); // 100% ç¨³å®šæ·»åŠ 
        }, totalDelay); 
        
      });
    }
    
    // --- 6. èšç„¦/å–æ¶ˆèšç„¦ åŠŸèƒ½ (V23 400ms ä¿®å¤) ---
    
    // V23 èšç„¦ (ä¿æŒç¨³å®š)
    function toggleFocus(card) {
      
      // V22 ä¸­æ–­é€»è¾‘ (ä¿æŒç¨³å®š)
      if (card.isRecycling) {
        clearTimeout(card.recycleTimer1);
        clearTimeout(card.recycleTimer2);
        card.isRecycling = false;
        
        card.style.transition = 'none'; 
        card.style.opacity = 0.8;
        card.style.transform = `translate(-50%, -50%) scale(1) rotate(${card.style.getPropertyValue('--final-rotate')})`;
        void card.offsetWidth; 
      }

      playSound(clickSound, 0.3);  
      const isAlreadyFocused = card.classList.contains('focused');
      
      // V23 400ms å¤±ç„¦ (ä¿æŒç¨³å®š)
      removeFocus();
      
      if (!isAlreadyFocused) {
        // V23 400ms èšç„¦ (ä¿æŒç¨³å®š)
        card.style.transition = `all ${FOCUS_ANIM_DURATION/1000}s cubic-bezier(0.68, -0.55, 0.27, 1.55)`;
        
        card.classList.add('focused');
        popupLayer.classList.add('is-focused'); // 100% æ·»åŠ é®ç½©
      }
    }
    
    // V23 å¤±ç„¦ (ä¿æŒç¨³å®š)
    function removeFocus() {
      const focusedCard = document.querySelector('.popup-message.focused');
      if (focusedCard) {
        
        // V23 400ms å¤±ç„¦ (ä¿æŒç¨³å®š)
        focusedCard.style.transition = `all ${FOCUS_ANIM_DURATION/1000}s cubic-bezier(0.68, -0.55, 0.27, 1.55)`;
        
        focusedCard.classList.remove('focused');
        focusedCard.style.zIndex = ++currentTopZ; // V20 ä»²è£å™¨
      }
      popupLayer.classList.remove('is-focused'); // 100% ç§»é™¤é®ç½©
    }

    // --- 7. V20 æ¨±èŠ±ç²’å­ç³»ç»Ÿ (ä¿æŒç¨³å®š) ---
    function createParticles() {
      if (!particleField) return;
      
      const particleCount = 40; 
      const fragment = document.createDocumentFragment();
      const colors = ['#FF69B4', '#FF1493', '#FFB6C1']; // V20: æ›´ç²‰çš„é¢œè‰²

      for (let i = 0; i < particleCount; i++) {
        
        const p = document.createElement('div');
        p.className = 'particle';
        p.innerHTML = 'ğŸŒ¸';
        
        const size = Math.random() * 10 + 10; 
        const xPos = Math.random() * 100;     
        
        const delay = Math.random() * -20;    
        const fallDuration = Math.random() * 10 + 10; 
        const driftX = Math.random() * 20 + 10; 

        p.style.fontSize = `${size}px`;
        p.style.left = `${xPos}%`;
        p.style.color = colors[Math.floor(Math.random() * colors.length)];
        
        p.style.setProperty('--delay', `${delay}s`);
        p.style.setProperty('--fall-dur', `${fallDuration}s`);
        p.style.setProperty('--drift-x', `${driftX}px`);
        p.style.setProperty('--drift-x-neg', `-${driftX}px`);
        
        fragment.appendChild(p);
      }
      particleField.appendChild(fragment);
    }
    
    // ç«‹å³æ‰§è¡Œç²’å­åˆ›å»º
    createParticles();
    
    // --- 8. V24 (Bug 2 ä¿®å¤): å¡ç‰‡å¾ªç¯ *è°ƒåº¦å™¨* ---
    
    // V22 å¯åŠ¨å™¨ (ä¿æŒç¨³å®š)
    function launchRecycleWorkers() {
      if (activeCards.length === 0) {
        setTimeout(launchRecycleWorkers, 1000); 
        return;
      }
      
      for (let i = 0; i < MAX_CONCURRENT_RECYCLES; i++) {
        recycleWorker(i); // å¯åŠ¨ 3 ä¸ªå·¥äºº
      }
    }
    
    // V22 å·¥äºº (ä¿æŒç¨³å®š)
    function recycleWorker(id) {
      
      // V22 "ç‚¹å‡»ä¸­æ–­" (å…¨å±€æš‚åœ) (ä¿æŒç¨³å®š)
      if (document.querySelector('.popup-message.focused')) {
        const sleep = RECYCLE_WORKER_SLEEP_MIN + (Math.random() * (RECYCLE_WORKER_SLEEP_MAX - RECYCLE_WORKER_SLEEP_MIN));
        setTimeout(() => recycleWorker(id), sleep);
        return;
      }

      // V22 "å·¥äººæ± " (ä¿æŒç¨³å®š)
      let availableCards = activeCards.filter(c => !c.isRecycling && !c.classList.contains('focused'));
      if (availableCards.length === 0) {
        const sleep = RECYCLE_WORKER_SLEEP_MIN + (Math.random() * (RECYCLE_WORKER_SLEEP_MAX - RECYCLE_WORKER_SLEEP_MIN));
        setTimeout(() => recycleWorker(id), sleep);
        return;
      }

      const card = availableCards[Math.floor(Math.random() * availableCards.length)];
      card.isRecycling = true; // 100% æ ‡è®°ä¸ºâ€œå ç”¨â€

      // V22 "æ‰§è¡ŒåŠ¨ç”»"
      recycleCard(card);

      // V22 "è®¡åˆ’ä¸‹æ¬¡" (ä¿æŒç¨³å®š)
      const sleep = RECYCLE_ANIM_DURATION * 2 + RECYCLE_WORKER_SLEEP_MIN + (Math.random() * (RECYCLE_WORKER_SLEEP_MAX - RECYCLE_WORKER_SLEEP_MIN));
      setTimeout(() => recycleWorker(id), sleep);
    }
    
    // V24 ä¿®å¤ (Bug 2): *å•å¡ç‰‡* åŠ¨ç”»
    function recycleCard(card) {
      
      // V23 JS è¿‡æ¸¡ (ä¿æŒç¨³å®š)
      card.style.transition = `opacity ${RECYCLE_ANIM_DURATION/1000}s ease-out, transform ${RECYCLE_ANIM_DURATION/1000}s ease-out`;
      card.style.opacity = 0;
      card.style.transform = 'translate(-50%, -50%) scale(0.8) rotate(var(--final-rotate))';
      
      // V22 å¯ä¸­æ–­å®šæ—¶å™¨ (ä¿æŒç¨³å®š)
      card.recycleTimer1 = setTimeout(() => {
        // V20 Z-Index ä»²è£å™¨ (100% ç¨³å®š)
        card.style.zIndex = ++currentTopZ; 
        
        /* V24 ä¿®å¤ (Bug 2): 100% ä¿®å¤â€œé›†ä¸­åœ¨ä¸Šé¢â€
         V23 (Buggy): newTop = Math.random() * 40 + 10; (10%-50%)
         V24 (Fixed): newTop = Math.random() * 80 + 10; (10%-90%)
        */
        const newTop = Math.random() * 80 + 10; 
        const newLeft = Math.random() * 80 + 10;
        
        card.style.transition = 'none'; // 100% å…ˆé‡ç½®
        card.style.top = `${newTop}%`;
        card.style.left = `${newLeft}%`;
        card.style.setProperty('--final-top', `${newTop}%`);
        card.style.setProperty('--final-left', `${newLeft}%`);
        
        void card.offsetWidth;
        
        // V23 JS è¿‡æ¸¡ (ä¿æŒç¨³å®š)
        card.style.transition = `opacity ${RECYCLE_ANIM_DURATION/1000}s ease-in, transform ${RECYCLE_ANIM_DURATION/1000}s ease-in`;
        card.style.opacity = 0.8;
        card.style.transform = 'translate(-50%, -50%) scale(1) rotate(var(--final-rotate))';
        
        // V22 å¯ä¸­æ–­å®šæ—¶å™¨ (ä¿æŒç¨³å®š)
        card.recycleTimer2 = setTimeout(() => {
          card.isRecycling = false; // 100% æ ‡è®°ä¸ºâ€œç©ºé—²â€
        }, RECYCLE_ANIM_DURATION);
        
      }, RECYCLE_ANIM_DURATION); 
    }

  </script>
  
</body></html>